# 裝置管理功能測試指南

## 測試環境

開發伺服器已啟動在：`http://localhost:5176/`

## 測試步驟

### 1. 測試裝置管理頁面

1. 訪問 `http://localhost:5176/admin`
2. 點擊「裝置管理」按鈕
3. 應該看到裝置管理頁面，包含：
   - 標題「訊號裝置管理」
   - 社區篩選下拉選單
   - 「新增裝置」按鈕
   - 裝置列表表格

#### 測試新增裝置

1. 點擊「新增裝置」按鈕
2. 在彈出的對話框中：
   - 選擇「所屬社區」（例如：大安社區）
   - 觀察「預覽裝置編號」應該顯示類似「大安社001」
   - 輸入 MAC Address（例如：`AA:BB:CC:DD:EE:FF`）
   - 可選填備註
3. 點擊「建立」
4. 應該看到「建立成功！」提示
5. 裝置應該出現在列表中，狀態為「可用」

#### 測試編輯裝置

1. 點擊裝置列表中的編輯圖示（鉛筆圖示）
2. 可以修改 MAC Address 和備註
3. 注意：所屬社區不可修改
4. 點擊「更新」保存變更

#### 測試刪除裝置

1. 點擊裝置列表中的刪除圖示（垃圾桶圖示）
2. 如果裝置狀態為「可用」，應該可以刪除
3. 如果裝置狀態為「已配發」，應該顯示錯誤訊息

### 2. 測試長輩管理整合

#### 從管理後台測試

1. 訪問 `http://localhost:5176/admin/elders`
2. 點擊「新增長者」按鈕
3. 在表單中：
   - 選擇「所屬社區」
   - 觀察「選擇裝置」下拉選單應該載入該社區的可用裝置
   - 從下拉選單選擇一個裝置
   - 觀察「或手動輸入 MAC Address」欄位應該被禁用
   - 填寫其他必填欄位（姓名等）
4. 點擊「建立」
5. 應該看到「建立成功！」提示
6. 回到裝置管理頁面，該裝置狀態應該變為「已配發」

#### 從 LIFF 端測試

1. 訪問 `http://localhost:5176/liff`
2. 選擇一個社區（模擬 LIFF 環境）
3. 點擊「新增長者」按鈕
4. 應該看到：
   - 「選擇裝置（推薦）」下拉選單
   - 「或手動輸入 MAC 位址」欄位
5. 測試選擇裝置功能
6. 測試手動輸入 MAC 功能

### 3. 測試裝置狀態同步

#### 測試配發流程

1. 新增一個裝置（狀態：可用）
2. 新增一個長輩並選擇該裝置
3. 檢查裝置管理頁面：
   - 裝置狀態應該變為「已配發」
   - 配發對象應該顯示長輩姓名

#### 測試解除配發

1. 編輯已配發裝置的長輩
2. 選擇「不選擇（手動輸入MAC）」
3. 手動輸入一個新的 MAC Address
4. 保存後檢查裝置管理頁面：
   - 原裝置狀態應該變回「可用」
   - 配發對象應該清空

### 4. 測試社區篩選

1. 建立多個社區和裝置
2. 在裝置管理頁面使用社區篩選
3. 應該只顯示選定社區的裝置
4. 選擇「全部社區」應該顯示所有裝置

### 5. 測試裝置編號生成

1. 為同一個社區新增多個裝置
2. 觀察裝置編號應該依序遞增：
   - 第一個：大安社001
   - 第二個：大安社002
   - 第三個：大安社003
   - ...

## 預期結果

### 裝置管理頁面

- ✅ 可以新增裝置
- ✅ 裝置編號自動生成（社區名稱前3字 + 流水號）
- ✅ 可以編輯裝置 MAC Address
- ✅ 可以刪除未配發的裝置
- ✅ 無法刪除已配發的裝置
- ✅ 可以按社區篩選裝置

### 長輩管理整合

- ✅ 選擇社區後自動載入可用裝置
- ✅ 可以從下拉選單選擇裝置
- ✅ 選擇裝置後自動填入 MAC Address
- ✅ 可以選擇不使用裝置，手動輸入 MAC
- ✅ 配發後裝置狀態自動更新

### 資料一致性

- ✅ 裝置配發後狀態正確更新
- ✅ 解除配發後狀態正確恢復
- ✅ 裝置與長輩的關聯正確建立
- ✅ 配發對象資訊正確顯示

## 常見問題排查

### 裝置列表是空的

1. 檢查是否已建立社區
2. 檢查是否已為該社區新增裝置
3. 檢查 Firestore 中的 `devices` collection

### 無法選擇裝置

1. 確認已選擇所屬社區
2. 確認該社區有可用的裝置
3. 檢查瀏覽器控制台是否有錯誤訊息

### 裝置狀態沒有更新

1. 檢查 Firestore 規則是否允許寫入
2. 檢查瀏覽器控制台的錯誤訊息
3. 重新整理頁面查看最新狀態

## 資料庫檢查

可以在 Firebase Console 中檢查以下 collections：

1. `devices` - 查看裝置資料
2. `elders` - 查看長輩資料（應包含 `deviceId` 欄位）
3. `tenants` - 查看社區資料

## 下一步

完成測試後，可以考慮：

1. 部署到測試環境
2. 進行整合測試
3. 收集用戶反饋
4. 實作進階功能（批次匯入、維護記錄等）
